{"version":3,"sources":["src/utils/dom.js","src/utils/pipe.js","src/utils/tap.js","src/utils/event-listeners.js","src/lib/canvas/make-canvas.js","src/lib/canvas/load-image.js","src/lib/core/make-puzzle.js","src/utils/object-helpers.js","src/utils/get-neighbors.js","src/utils/sides.js","src/utils/bezier.js","src/utils/random.js","src/lib/core/make-shapes.js","src/lib/core/make-pieces.js","src/lib/core/shuffle.js","src/utils/array-helpers.js","src/lib/canvas/paint-piece.js","src/lib/canvas/clear-canvas.js","src/lib/canvas/paint-layers.js","src/lib/canvas/paint.js","src/utils/run-if.js","src/utils/is-under-cursor.js","src/lib/core/activate.js","src/lib/core/deactivate.js","src/lib/core/move.js","src/lib/core/share-connections.js","src/lib/core/is-close.js","src/lib/core/snap.js","src/lib/core/status.js","src/lib/core/gather.js","src/lib/core/clone.js","src/lib/canvas/make-layers.js","src/lib/canvas/cursor.js","src/lib/core/move-foreground.js","src/index.js","demo.js","../../.config/yarn/global/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["$","selector","document","querySelector","pipe","fns","x","reduce","acc","f","tap","fn","addListener","what","el","cb","name","addEventListener","remove","removeEventListener","event","canvas","scroll","window","resize","click","element","mousedown","mousemove","mouseup","body","updCanvas","state","top","left","getBoundingClientRect","pos","y","makeCanvas","DPI","devicePixelRatio","tagName","createElement","ctx","getContext","bg","fg","height","width","getComputedStyle","parseInt","style","appendChild","background","foreground","loadImage","src","Promise","resolve","image","Image","onload","makePuzzle","ps","img","attraction","container","size","draggable","onComplete","isPortrait","scale","timeStamp","Date","now","done","cols","rows","occupy","isTruthy","prop","obj","removeNull","newObj","Object","keys","forEach","same","val","getNeighbors","i","slot","neighbors","right","bottom","allSides","opposite","side","isVertical","isHorizontal","sw","nw","bezier","pieceSize","knobSize","middle","cx1","cy1","cx2","cy2","ex","ey","bezierInv","b","map","bb","random","hash","Math","cos","sin","makeShapes","piece","getNeighbor","id","find","neighborShape","shapes","flatSides","filter","includes","shapedSides","min","makePieces","puzzle","piecesAmount","Array","pieces","orgPos","floor","curPos","active","connections","shuffle","xs","sort","filterUniqe","Set","randomElement","length","activeLast","connectedFirst","reverse","slice","mapReverse","reduceRight","arr","paintPiece","customContext","shapeOffset","max","save","beginPath","translate","drawSide","closePath","clip","drawImage","restore","highlight","alsoActive","shadowColor","strokeStyle","shadowBlur","lineWidth","shadowOffsetX","shadowOffsetY","lineCap","lineJoin","stroke","lineTo","bezierCurveTo","rotate","PI","clearCanvas","clearRect","paintLayers","activePieces","paint","runIf","isWithinX","e","clientX","isWithinY","clientY","isUnderCursor","getPiecePos","activate","p","deactivate","move","shareConnections","newPiece","connection","isClose","p1","p2","XY","invXY","positive","offset","moveConnections","pieceIds","distance","snap","entries","neighbor","newPos","status","gather","clone","JSON","parse","stringify","makeLayers","getCursor","hovered","allActive","every","cursor","setCursor","moveForeground","onChange","changecb","console","warn","initState","eventListeners","newGame","getState","setState","newState","update","destroy","listener","init","solution","saveGame","loadGame","source","X","Y","images","innerHTML","toFixed","display","options","saveFile","value","target","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","data","hotData","_acceptCallbacks","_disposeCallbacks","accept","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","type","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","generated","js","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","log","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","getElementById","stackTrace","innerText","getParents","modules","parents","k","d","dep","isArray","concat","Function","deps","cached","cache","some"],"mappings":"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","file":"demo.d3b53871.js","sourceRoot":"..","sourcesContent":["export const $ = (selector) => document.querySelector(selector);\n","export const pipe = (...fns) => (x) => [...fns].reduce((acc, f) => f(acc), x);\n","export const tap = (fn) => (x) => {\n  fn(x);\n  return x;\n};\n","const addListener = (what, el, cb) => {\n  const name = cb;\n  el.addEventListener(what, cb);\n  return {\n    remove: () => el.removeEventListener(what, name),\n  };\n};\n\nexport const event = (canvas) => ({\n  scroll: (cb) => addListener(\"scroll\", window, cb),\n  resize: (cb) => addListener(\"resize\", window, cb),\n  click: (cb) => addListener(\"click\", canvas.element, cb),\n  mousedown: (cb) => addListener(\"mousedown\", canvas.element, cb),\n  mousemove: (cb) => addListener(\"mousemove\", canvas.element, cb),\n  mouseup: (cb) => addListener(\"mouseup\", document.body, cb),\n});\n","export const updCanvas = state => {\n  const { top, left } = state.canvas.element.getBoundingClientRect()\n  // const { width, height } = getComputedStyle(state.canvas.element);\n  state.canvas.pos = { x: left, y: top }\n  // state.canvas.width = parseInt(width, 0);\n  // state.canvas.height = parseInt(height, 0);\n\n  return state\n}\n\nexport const makeCanvas = element => {\n  const DPI = window.devicePixelRatio\n  const canvas =\n    element.tagName === 'CANVAS' ? element : document.createElement('canvas')\n  const ctx = canvas.getContext('2d')\n  const bg = document.createElement('canvas')\n  const fg = document.createElement('canvas')\n\n  const { height, width } = getComputedStyle(element)\n\n  canvas.width = bg.width = fg.width = parseInt(width, 0) * DPI\n  canvas.height = bg.height = fg.height = parseInt(height, 0) * DPI\n  canvas.style.width = bg.style.width = fg.style.width =\n    parseInt(width, 0) + 'px'\n  canvas.style.height = bg.style.height = fg.style.height =\n    parseInt(height, 0) + 'px'\n\n  if (element.tagName !== 'CANVAS') {\n    element.appendChild(canvas)\n  }\n  // element.appendChild(bg)\n  // element.appendChild(fg)\n\n  const { top, left } = canvas.getBoundingClientRect()\n\n  return {\n    element: canvas,\n    background: { canvas: bg, ctx: bg.getContext('2d') },\n    foreground: {\n      canvas: fg,\n      ctx: fg.getContext('2d'),\n      pos: { x: null, y: null },\n    },\n    ctx,\n    pos: { x: left, y: top },\n    width: canvas.width,\n    height: canvas.height,\n    DPI,\n  }\n}\n","export const loadImage = (src) =>\n  new Promise((resolve) => {\n    var image = new Image();\n    image.onload = () =>\n      resolve({ image, width: image.width, height: image.height });\n\n    image.src = src;\n  });\n","export const makePuzzle = (\n  ps,\n  img,\n  attraction,\n  container,\n  size,\n  draggable,\n  onComplete\n) => {\n  const { width, height } = getComputedStyle(container);\n  const isPortrait = img.width < img.height;\n  const DPI = window.devicePixelRatio;\n  const scale =\n    parseInt([isPortrait ? height : width], 0) /\n    img[isPortrait ? \"height\" : \"width\"];\n\n  return {\n    timeStamp: Date.now(),\n    done: false,\n    cols: ps.x,\n    rows: ps.y,\n    width: img.width * scale * DPI,\n    height: img.height * scale * DPI,\n    attraction,\n    scale,\n    occupy: size,\n    draggable,\n    onComplete,\n  };\n};\n","export const isTruthy = (prop) => (obj) => obj[prop];\n\n// rm keys with value null from obj\nexport const removeNull = (obj) => {\n  let newObj = {};\n  Object.keys(obj).forEach((prop) => {\n    if (obj[prop] !== null) {\n      newObj[prop] = obj[prop];\n    }\n  });\n  return newObj;\n};\n\nexport const same = (val, prop) => (obj) => obj[val] === prop;\n","import { removeNull } from './object-helpers.js'\n\n// calculates which pieces are next to given piece\n// breaks if rows/cols are 1\nexport const getNeighbors = (i, rows, cols) => {\n  const slot = i + 1\n\n  const neighbors = {\n    top: slot > cols ? i - cols : null,\n    right: slot % cols !== 0 ? i + 1 : null,\n    bottom: slot <= (rows - 1) * cols ? i + cols : null,\n    left: slot % cols !== 1 ? i - 1 : null,\n  }\n\n  return removeNull(neighbors)\n}\n","export const allSides = [\"top\", \"right\", \"bottom\", \"left\"];\nexport const opposite = (side) =>\n  ({\n    top: \"bottom\",\n    right: \"left\",\n    bottom: \"top\",\n    left: \"right\",\n  }[side]);\n\nexport const isVertical = (side) => side === \"top\" || side === \"bottom\";\nexport const isHorizontal = (side) => !isVertical(side);\n\nexport const sw = (side) => side === \"bottom\" || side === \"left\";\nexport const nw = (side) => side === \"top\" || side === \"left\";\n","export const bezier = (pieceSize = 100, knobSize = 100 /* knobPos = 20 */) => {\n  const scale = knobSize / 110;\n  const middle = pieceSize / 2;\n\n  return [\n    {\n      cx1: 0,\n      cy1: 0,\n      cx2: middle - scale * 10,\n      cy2: scale * 5,\n      ex: middle - scale * 13,\n      ey: scale * 0,\n    }, // left shoulder\n    {\n      cx1: middle - scale * 13,\n      cy1: scale * 0,\n      cx2: middle - scale * 10,\n      cy2: scale * -2,\n      ex: middle - scale * 12,\n      ey: scale * -5,\n    }, // left neck\n    {\n      cx1: middle - scale * 12,\n      cy1: scale * -5,\n      cx2: middle - scale * 30,\n      cy2: scale * -30,\n      ex: middle,\n      ey: scale * -30,\n    }, // left head\n    {\n      cx1: middle,\n      cy1: scale * -30,\n      cx2: middle - scale * -30,\n      cy2: scale * -31,\n      ex: middle - scale * -12,\n      ey: scale * -5,\n    }, // right head\n    {\n      cx1: middle - scale * -12,\n      cy1: scale * -5,\n      cx2: middle - scale * -10,\n      cy2: scale * -2,\n      ex: middle - scale * -13,\n      ey: scale * 0,\n    }, // right neck\n    {\n      cx1: middle - scale * -13,\n      cy1: scale * 0,\n      cx2: middle - scale * -10,\n      cy2: scale * 5,\n      ex: pieceSize,\n      ey: scale * 0,\n    }, // right shoulder\n  ];\n};\n\nexport const bezierInv = (b, y = 1) =>\n  b.map((bb, i) => ({\n    cx1: bb.cx1 * y,\n    cy1: bb.cy1 * -1,\n    cx2: bb.cx2 * y,\n    cy2: bb.cy2 * -1,\n    ex: bb.ex * y,\n    ey: bb.ey * -1,\n  }));\n","// random number 0 - 1, based on hash\nexport const random = (hash = Math.random()) =>\n  (Math.cos(Math.sin((hash + 69) * 1337.1337) * 6669.1337) + 1) * 0.5;\n","import { allSides, opposite, isVertical, sw } from \"./../../utils/sides.js\";\nimport { bezier, bezierInv } from \"./../../utils/bezier.js\";\nimport { random } from \"./../../utils/random.js\";\n\nexport const makeShapes = (acc, piece) => {\n  const getNeighbor = (id) => acc.find((piece) => piece.id === id);\n  const neighborShape = (id, side) =>\n    getNeighbor(id) &&\n    getNeighbor(id).shapes &&\n    getNeighbor(id).shapes[opposite(side)];\n\n  // 'flat' if no neighbor\n  const flatSides = ({ neighbors }) =>\n    allSides\n      .filter((side) => !Object.keys(neighbors).includes(side))\n      .reduce((acc, side) => ({ [side]: \"flat\", ...acc }), {});\n\n  // a random- or an inverse bezier if the neighbor has a shape\n  const shapedSides = ({ neighbors, width, height }) =>\n    Object.keys(neighbors).reduce(\n      (acc, side) => ({\n        [side]: neighborShape(neighbors[side], side) // neighbor has shape\n          ? bezierInv(neighborShape(neighbors[side], side)) // mirror that shape\n          : random() >= 0.5 // else 50/50\n          ? bezier(isVertical(side) ? width : height, Math.min(width, height)) // be 'outy'\n          : bezierInv(\n              bezier(isVertical(side) ? width : height, Math.min(width, height))\n            ), // or 'inny\n        ...acc,\n      }),\n      {}\n    );\n\n  const shapes = {\n    ...shapedSides(piece),\n    ...flatSides(piece),\n  };\n\n  return [{ ...piece, shapes }, ...acc];\n};\n","import { getNeighbors } from \"./../../utils/get-neighbors.js\";\nimport { makeShapes } from \"./make-shapes.js\";\n\nexport const makePieces = (puzzle) => {\n  const piecesAmount = [...Array(puzzle.rows * puzzle.cols)];\n  const width = (puzzle.width / puzzle.cols) * puzzle.occupy;\n  const height = (puzzle.height / puzzle.rows) * puzzle.occupy;\n  const pieces = piecesAmount\n    .map((x, i) => ({\n      id: i,\n      orgPos: {\n        x: (i % puzzle.cols) * width,\n        y: Math.floor(i / puzzle.cols) * height,\n      },\n      curPos: { x: 0, y: 0 },\n      width,\n      height,\n      neighbors: getNeighbors(i, puzzle.rows, puzzle.cols),\n      active: false, // if clicked/dragged\n      connections: [], // every other piece this one is snapped together with\n    }))\n    .reduce(makeShapes, []);\n\n  return pieces;\n};\n","import { random } from \"./../../utils/random.js\";\n\nexport const shuffle = (state) => ({\n  ...state,\n  pieces: state.pieces.map((piece, i) => ({\n    ...piece,\n    connections: [],\n    curPos: {\n      x: random() * (state.canvas.width - state.pieces[0].width),\n      y: random() * (state.canvas.height - state.pieces[0].height),\n    },\n  })),\n});\n","const { floor, random } = Math;\n\nexport const shuffle = (xs) =>\n  xs\n    .map((x) => [random(), x])\n    .sort((x, y) => x[0] - y[0])\n    .map((x) => x[1]);\n\n// shallow filtering\nexport const filterUniqe = (xs) => [...new Set(xs)];\nexport const randomElement = (xs) => xs[floor(random() * xs.length)];\nexport const activeLast = (x, y) => (y.active ? -1 : 1);\nexport const connectedFirst = (x, y) =>\n  x.connections.length > y.connections.length ? -1 : 1;\nexport const reverse = (xs) => xs.slice(0).reverse();\nexport const map = (fn) => (xs) => xs.map(fn);\nexport const mapReverse = (fn) => (xs) =>\n  xs.reduceRight((acc, el, i, arr) => [...acc, fn(el, i, arr, acc)], []);\n\nexport const sort = (fn) => (xs) => xs.sort(fn);\n","import { allSides } from '../../utils/sides.js'\n\nexport const paintPiece = (state, customContext) => piece => {\n  const { image } = state.image\n  const { ctx, DPI = 2 } = customContext || state.canvas\n  const { scale, occupy } = state.puzzle\n  const shapeOffset = Math.max(piece.width, piece.height)\n\n  ctx.save()\n  ctx.beginPath()\n  ctx.translate(piece.curPos.x, piece.curPos.y + piece.height)\n\n  allSides.forEach(side => {\n    drawSide(ctx, piece.shapes[side], {\n      x: side === 'top' || side === 'bottom' ? -piece.height : -piece.width,\n      y: side === 'top' || side === 'bottom' ? piece.width : piece.height,\n    })\n  })\n\n  ctx.closePath()\n  ctx.clip()\n\n  ctx.drawImage(\n    image, // image\n    (piece.orgPos.x - shapeOffset) / scale / DPI / occupy, // what part of image\n    (piece.orgPos.y - shapeOffset) / scale / DPI / occupy, // what part of image\n    (piece.width + shapeOffset * 2) / scale / DPI / occupy, // how much of image\n    (piece.height + shapeOffset * 2) / scale / DPI / occupy, // how much of image\n    piece.curPos.x / state.canvas.width - shapeOffset, // where on canvas\n    piece.curPos.y / state.canvas.height - shapeOffset - piece.height, // where on canvas\n    piece.width + shapeOffset * 2, // how big on canvas\n    piece.height + shapeOffset * 2 // how big on canvas\n  )\n\n  ctx.restore()\n\n  const highlight = !state.puzzle.done && (piece.active || piece.alsoActive)\n\n  ctx.shadowColor = highlight ? 'rgba(100, 100, 100, 1)' : 'rgba(50, 50, 50, 1)'\n  ctx.strokeStyle = highlight\n    ? 'rgba(225, 225, 225, 1)'\n    : 'rgba(220, 220, 220, 1)'\n  ctx.shadowBlur = highlight ? 2 : 1\n  ctx.lineWidth = highlight ? 2 : 1\n\n  ctx.shadowOffsetX = ctx.shadowOffsetY = -1\n  ctx.lineCap = 'round'\n  ctx.lineJoin = 'round'\n\n  ctx.stroke()\n}\n\nfunction drawSide(ctx, side, size) {\n  ctx.translate(0, size.x)\n\n  if (side === 'flat') {\n    ctx.lineTo(size.y, 0)\n  } else {\n    side.forEach(b => {\n      ctx.bezierCurveTo(b.cx1, b.cy1, b.cx2, b.cy2, b.ex, b.ey)\n    })\n  }\n\n  ctx.rotate(Math.PI / 2)\n}\n","export const clearCanvas = (state, ctx) => {\n  ctx.clearRect(0, 0, state.canvas.width, state.canvas.height);\n  return ctx;\n};\n","import { map } from '../../utils/array-helpers'\nimport { paintPiece } from './paint-piece'\n\nexport const paintLayers = state => {\n  state.canvas.ctx.drawImage(state.canvas.background.canvas, 0, 0)\n  //   state.canvas.ctx.drawImage(\n  //     state.canvas.foreground.canvas,\n  //     state.canvas.foreground.pos.x * state.canvas.DPI,\n  //     state.canvas.foreground.pos.y * state.canvas.DPI\n  //   )\n  const activePieces = state.pieces.filter(({ active }) => active)\n  map(paintPiece(state))(activePieces)\n}\n","import { map } from '../../utils/array-helpers.js'\nimport { tap } from '../../utils/tap.js'\nimport { paintPiece } from './paint-piece.js'\nimport { clearCanvas } from './clear-canvas.js'\nimport { paintLayers } from './paint-layers.js'\n\n// export const paint = (state) => ({\n//   ...state,\n//   canvas: {\n//     ...state.canvas,\n//     ctx: clearCanvas(state, state.canvas.ctx),\n//   },\n//   pieces: map(tap(paintPiece(state)))(state.pieces),\n// });\n\nexport const paint = tap(state => {\n  clearCanvas(state, state.canvas.ctx)\n  paintLayers(state)\n  // state.pieces = map(tap(paintPiece(state)))(state.pieces)\n})\n","// ex. runIf(console.log)(true)('foo') -> prints 'foo'\n// ex. runIf(console.log)(false)('bar') -> returns 'bar'\n// ex. runIf(console.log)(x => x === 'bar'))('bar') -> prints 'bar'\nexport const runIf = (fn) => (x) => (y) =>\n  (typeof x === \"function\" ? x(y) : x) ? fn(y) : y;\n","export const isWithinX = (state, piece, e) =>\n  (e.clientX - state.canvas.pos.x) * state.canvas.DPI >= piece.curPos.x &&\n  (e.clientX - state.canvas.pos.x) * state.canvas.DPI <=\n    piece.curPos.x + piece.width\n\nexport const isWithinY = (state, piece, e) =>\n  (e.clientY - state.canvas.pos.y) * state.canvas.DPI >= piece.curPos.y &&\n  (e.clientY - state.canvas.pos.y) * state.canvas.DPI <=\n    piece.curPos.y + piece.height\n\nexport const isUnderCursor = (state, piece, e) =>\n  isWithinX(state, piece, e) && isWithinY(state, piece, e)\n","import { activeLast, mapReverse, sort, map } from \"../../utils/array-helpers.js\";\nimport { isTruthy } from \"../../utils/object-helpers.js\";\nimport { runIf } from \"../../utils/run-if.js\";\nimport { pipe } from \"../../utils/pipe.js\";\nimport { isUnderCursor } from \"../../utils/is-under-cursor.js\";\n\nconst getPiecePos = (state, piece, e) => ({\n  x: (e.clientX - state.canvas.pos.x) * state.canvas.DPI - piece.curPos.x,\n  y: (e.clientY - state.canvas.pos.y) * state.canvas.DPI - piece.curPos.y,\n});\n\n// pieces gets painted bottom to top, we need to check in reverse order\nexport const activate = (e) => (state) => ({\n  ...state,\n  pieces: pipe(\n    // activate clicked piece (first occurence)\n    mapReverse((piece, i, arr, acc) => ({\n      ...piece,\n      active:\n        !acc.find(isTruthy(\"active\")) && isUnderCursor(state, piece, e)\n          ? getPiecePos(state, piece, e)\n          : false,\n    })),\n\n    mapReverse((piece, i, arr) => ({\n      ...piece,\n      // activate the active piece's connections\n      active: arr.find((p) => p.active && p.connections.includes(piece.id))\n        ? getPiecePos(state, piece, e)\n        : // activate all pieces if none was clicked (and puzzle is draggable)\n        !arr.find(isTruthy(\"active\")) && state.puzzle.draggable\n        ? getPiecePos(state, piece, e)\n        : piece.active,\n    })),\n\n    // put the active piece(s) on top\n    // if puzzle isn't done or not all pieces are active (puzzle dragged)\n    runIf(sort(activeLast))(\n      (ps) =>\n        !state.puzzle.done &&\n        ps.filter((p) => p.active).length !== state.pieces.length\n    )\n  )(state.pieces),\n});\n","export const deactivate = (state) => ({\n  ...state,\n  pieces: state.pieces\n    // .sort(connectedFirst)\n    .map((piece) => ({\n      ...piece,\n      active: false,\n    })),\n});\n","export const move = ({ clientX, clientY }) => (state) => ({\n  ...state,\n  pieces: state.pieces.map((piece) => ({\n    ...piece,\n    curPos: piece.active\n      ? {\n          x: (clientX - state.canvas.pos.x) * state.canvas.DPI - piece.active.x,\n          y: (clientY - state.canvas.pos.y) * state.canvas.DPI - piece.active.y,\n        }\n      : piece.curPos,\n  })),\n});\n","import { filterUniqe } from \"./../../utils/array-helpers.js\";\n\n// should return, not modify\nexport const shareConnections = (state, piece, newPiece) => {\n  piece.connections = filterUniqe([\n    piece.id,\n    newPiece.id,\n    ...piece.connections,\n    ...newPiece.connections,\n  ]);\n\n  piece.connections.forEach((id) => {\n    const connection = state.pieces.find((piece) => piece.id === id);\n    connection.connections = filterUniqe(piece.connections);\n  });\n\n  newPiece.connections.forEach((id) => {\n    const connection = state.pieces.find((piece) => piece.id === id);\n    connection.connections = filterUniqe(piece.connections);\n  });\n};\n","import { isVertical, nw } from \"./../../utils/sides.js\";\n\n// is piece1 close to piece2\nexport const isClose = (p1, p2, state, side) => {\n  const { attraction } = state.puzzle;\n\n  const XY = isVertical(side) ? \"y\" : \"x\";\n  const invXY = XY === \"x\" ? \"y\" : \"x\";\n\n  const positive = nw(side) ? false : true;\n\n  const size = p1[XY === \"y\" ? \"height\" : \"width\"];\n  const offset = positive ? p2.curPos[XY] + size : p2.curPos[XY] - size;\n\n  return (\n    p1.curPos[XY] <= offset + attraction &&\n    p1.curPos[XY] >= offset - attraction &&\n    p1.curPos[invXY] <= p2.curPos[invXY] + attraction &&\n    p1.curPos[invXY] >= p2.curPos[invXY] - attraction\n  );\n};\n","import { shareConnections } from \"./share-connections.js\";\nimport { isClose } from \"./is-close.js\";\nimport { same } from \"./../../utils/object-helpers.js\";\n\nconst moveConnections = (state, [...pieceIds], distance) => {\n  pieceIds.forEach((id) => {\n    const piece = state.pieces.find(same(\"id\", id));\n    piece.curPos = {\n      x: piece.curPos.x + distance.x,\n      y: piece.curPos.y + distance.y,\n    };\n  });\n};\n\n// export const snapNew = (state) => ({\n//   ...state,\n//   pieces: state.pieces.map((piece) => ({\n//     ...piece,\n//     curPos:\n//       !piece.active ||\n//       !Object.entries(piece.neighbors).find(([side, id]) =>\n//         isClose(state.pieces.find(same(\"id\", id)), piece, state, side)\n//       )\n//         ? piece.curPos\n//         : { x: 10, y: 20 }\n//   }))\n// });\n\nexport const snap = (state) => {\n  const activePieces = state.pieces.filter((piece) => piece.active);\n\n  if (!activePieces.length || activePieces.length === state.pieces.length) {\n    return state;\n  }\n\n  activePieces.forEach((piece) => {\n    Object.entries(piece.neighbors).forEach(([side, id]) => {\n      const neighbor = state.pieces.find(same(\"id\", id));\n\n      if (isClose(neighbor, piece, state, side)) {\n        const newPos = {\n          x:\n            neighbor.curPos.x +\n            (side === \"right\"\n              ? -neighbor.width\n              : side === \"left\"\n              ? +neighbor.width\n              : 0),\n          y:\n            neighbor.curPos.y +\n            (side === \"top\"\n              ? neighbor.height\n              : side === \"bottom\"\n              ? -neighbor.height\n              : 0),\n        };\n\n        // order is important\n        moveConnections(state, piece.connections, {\n          x: newPos.x - piece.curPos.x,\n          y: newPos.y - piece.curPos.y,\n        });\n\n        piece.curPos = newPos;\n\n        // piece.connections = neighbor.connections = shareConnections(state, piece, neighbor);\n\n        shareConnections(state, piece, neighbor);\n      }\n    });\n  });\n\n  return state;\n};\n","export const status = (state) => {\n  if (\n    state.pieces[0].connections.length ===\n      state.puzzle.rows * state.puzzle.cols &&\n    !state.puzzle.done\n  ) {\n    state.puzzle.done = true;\n    state.puzzle.onComplete(state);\n  }\n  return state;\n};\n","export const gather = (state) => {\n  /**\n   * map pieces and move them onto the board after window resize\n   */\n  state.pieces = state.pieces.map((piece) => ({\n    ...piece,\n    curPos: {\n      x:\n        piece.curPos.x - piece.width > state.canvas.width * state.canvas.DPI\n          ? state.canvas.width - piece.width\n          : piece.curPos.x,\n      y:\n        piece.curPos.y - piece.height > state.canvas.height * state.canvas.DPI\n          ? state.canvas.height - piece.height\n          : piece.curPos.y,\n    },\n  }));\n  return state;\n};\n","export const clone = (state) => ({\n  image: state.image,\n  canvas: state.canvas,\n  pieces: JSON.parse(JSON.stringify(state.pieces)),\n  puzzle: JSON.parse(JSON.stringify(state.puzzle)),\n});\n","import { paintPiece } from './paint-piece.js'\nimport { clearCanvas } from './clear-canvas.js'\nimport { map } from '../../utils/array-helpers.js'\nimport { tap } from '../../utils/tap.js'\n\nexport const makeLayers = tap(state => {\n  state.canvas.background.ctx = clearCanvas(state, state.canvas.background.ctx)\n  state.canvas.foreground.ctx = clearCanvas(state, state.canvas.foreground.ctx)\n\n  map(paintPiece(state, { ctx: state.canvas.background.ctx }))(\n    state.pieces.filter(({ active }) => !active)\n  )\n  \n  map(paintPiece(state, { ctx: state.canvas.foreground.ctx }))(\n    state.pieces.filter(({ active }) => active)\n  )\n})\n","import { isUnderCursor } from '../../utils/is-under-cursor.js'\nimport { tap } from '../../utils/tap.js'\n\nexport const getCursor = (e) => tap(state => {\n  const hovered = state.pieces.find((piece) => isUnderCursor(state, piece, e))\n  const active = state.pieces.find(piece => piece.active)\n  const allActive = state.pieces.every(piece => piece.active)\n\n  if(active && !allActive) {\n    state.canvas.cursor = 'grabbing'\n    return\n  }\n  \n  if (hovered && !active) {\n    state.canvas.cursor = 'grab'\n    return\n  }\n  \n  if (state.puzzle.draggable) {\n    state.canvas.cursor = 'move'\n    return\n  }\n})\n\nexport const setCursor = tap(state => {\n  state.canvas.element.style.cursor = state.canvas.cursor\n})\n","import { tap } from './../../utils/tap.js'\n\nexport const moveForeground = ({ clientX, clientY }) =>\n  tap(state => {\n    state.canvas.foreground.pos = {\n      x:\n        (clientX - state.canvas.pos.x) * state.canvas.DPI -\n        state.canvas.foreground.pos.x,\n      y:\n        (clientY - state.canvas.pos.y) * state.canvas.DPI -\n        state.canvas.foreground.pos.y,\n    }\n  })\n","import { $ } from './utils/dom.js'\nimport { pipe } from './utils/pipe.js'\nimport { tap } from './utils/tap.js'\nimport { event } from './utils/event-listeners.js'\n\nimport { makeCanvas, updCanvas } from './lib/canvas/make-canvas.js'\nimport { loadImage } from './lib/canvas/load-image.js'\nimport { makePuzzle } from './lib/core/make-puzzle.js'\nimport { makePieces } from './lib/core/make-pieces.js'\nimport { shuffle } from './lib/core/shuffle.js'\nimport { paint } from './lib/canvas/paint.js'\nimport { activate } from './lib/core/activate.js'\nimport { deactivate } from './lib/core/deactivate.js'\nimport { move } from './lib/core/move.js'\nimport { snap } from './lib/core/snap.js'\nimport { status } from './lib/core/status.js'\nimport { gather } from './lib/core/gather.js'\nimport { clone } from './lib/core/clone.js'\nimport { makeLayers } from './lib/canvas/make-layers.js'\nimport { getCursor, setCursor } from './lib/canvas/cursor.js'\nimport { moveForeground } from './lib/core/move-foreground.js'\n\nexport const puzzle = async ({\n  element,\n  restore = {},\n  image: img = '',\n  pieces: ps = { x: 6, y: 4 },\n  attraction = 20,\n  size = 0.8,\n  draggable = false,\n  onComplete = () => {},\n  onChange: changecb = () => {},\n}) => {\n  // game board\n  const container = typeof element === 'string' ? $(element) : element\n\n  if (!container) {\n    console.warn(`Couldn't find element: ${element}`)\n    return\n  }\n\n  // initial setup ---------------------------------------------\n  const canvas = makeCanvas(container)\n  const image = restore.image || (await loadImage(img))\n  const puzzle = () =>\n    restore.puzzle ||\n    makePuzzle(ps, image, attraction, container, size, draggable, onComplete)\n  const pieces = restore.pieces || makePieces(puzzle())\n\n  // passed on-change callback ---------------------------------\n  const onChange = typeof changecb === 'function' && tap(pipe(clone, changecb))\n\n  // initial state ---------------------------------------------\n  const initState = () => ({\n    image,\n    canvas,\n    pieces,\n    puzzle: puzzle(),\n  })\n\n  // 'global' game state ---------------------------------------\n  let state = initState()\n\n  // initial paint ---------------------------------------------\n  state = restore.puzzle\n    ? pipe(paint)(state)\n    : pipe(shuffle, makeLayers, paint)(state)\n\n  // user interactions -----------------------------------------\n  const eventListeners = [\n    event(window).resize(e => (state = pipe(updCanvas, gather, paint)(state))),\n    event(window).scroll(e => (state = pipe(updCanvas)(state))),\n    event(state.canvas).mousedown(\n      e =>\n        (state = pipe(\n          activate(e),\n          getCursor(e),\n          setCursor,\n          makeLayers,\n          paint\n        )(state))\n    ),\n    event(state.canvas).mousemove(e => {\n      state = pipe(\n        getCursor(e),\n        move(e),\n        moveForeground(e),\n        paint,\n        setCursor\n      )(state)\n    }),\n    event(document.body).mouseup(\n      e =>\n        (state = pipe(\n          snap,\n          deactivate,\n          makeLayers,\n          getCursor(e),\n          paint,\n          setCursor,\n          onChange,\n          status\n        )(state))\n    ),\n  ]\n\n  // exposed api -----------------------------------------------\n  return {\n    newGame: () => (state = pipe(shuffle, paint)(initState())),\n    getState: () => clone(state),\n    setState: newState => (state = pipe(clone, paint)(newState)),\n    update: () => (state = pipe(updCanvas, paint)(state)),\n    destroy: () => {\n      if (element.tagName !== 'CANVAS') {\n        state.canvas.element.remove()\n      }\n\n      state = null\n      eventListeners.map(listener => listener.remove())\n    },\n  }\n}\n\nexport default puzzle\n","import { puzzle } from \"./src/index.js\";\nimport { $ } from \"./src/utils/dom.js\";\n\nconst init = async () => {\n  const solution = $(\"#solution\");\n  const newGame = $(\"#new-game\");\n  const saveGame = $(\"#save-game\");\n  const loadGame = $(\"#load-game\");\n  const source = $(\"#source\");\n  const X = $(\"#x\");\n  const Y = $(\"#y\");\n\n  const images = [\n    'https://artsourceinternational.com/wp-content/uploads/2018/04/WOR0006.jpg',\n  ]\n\n  const onComplete = (state) => {\n    const done = $(\"#done\");\n    done.innerHTML = `Done! In ${(\n      (Date.now() - state.puzzle.timeStamp) /\n      1000\n    ).toFixed(1)}s`;\n    done.style.display = \"block\";\n  };\n\n  const onChange = (state) => {};\n\n  const options = {\n    element: \"#app\",\n    image: images[Math.floor((Date.now() / 1000) % images.length)],\n    pieces: { x: 50, y: 40 },\n    attraction: 40,\n    size: 0.8,\n    draggable: true,\n    onComplete,\n    onChange,\n  };\n\n  let saveFile = {};\n  let image = options.image;\n  let pieces = options.pieces;\n  solution.src = image;\n  X.value = options.pieces.x;\n  Y.value = options.pieces.y;\n  source.value = options.image;\n\n  let p = await puzzle(options);\n\n  newGame.addEventListener(\"click\", async () => p.newGame());\n  saveGame.addEventListener(\"click\", () => {\n    saveFile = p.getState();\n  });\n  loadGame.addEventListener(\"click\", () => p.setState(saveFile));\n  source.addEventListener(\"change\", async (e) => {\n    image = e.target.value;\n    p.destroy();\n    p = await puzzle({ ...options, image });\n    solution.src = image;\n  });\n  X.addEventListener(\"change\", async (e) => {\n    if (e.target.value < 2) return;\n    pieces = { ...pieces, x: parseInt(e.target.value, 0) };\n    p.destroy();\n    p = await puzzle({ ...options, image, pieces });\n  });\n  Y.addEventListener(\"change\", async (e) => {\n    if (e.target.value < 2) return;\n    pieces = { ...pieces, y: parseInt(e.target.value, 0) };\n    p.destroy();\n    p = await puzzle({ ...options, image, pieces });\n  });\n};\n\ninit();\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}