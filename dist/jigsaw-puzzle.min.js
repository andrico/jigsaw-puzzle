var jigsawPuzzle=function(e){"use strict";const t=e=>t=>(e(t),t),o=(e=Math.random())=>.5*(Math.cos(6669.1337*Math.sin(1337.1337*(e+69)))+1),n=e=>t=>o=>("function"==typeof t?t(o):t)?e(o):o,i=(...e)=>t=>[...e].reduce(((e,t)=>t(e)),t),s=(e,t,o)=>{const n=o;return t.addEventListener(e,o),{remove:()=>t.removeEventListener(e,n)}},a=e=>({scroll:e=>s("scroll",window,e),resize:e=>s("resize",window,e),click:t=>s("click",e,t),pointerdown:t=>s("pointerdown",e,t),pointermove:t=>s("pointermove",e,t),pointerup:e=>s("pointerup",document.body,e)}),c=(e,t)=>o=>o[e]===t,r=(e,t,o)=>{const n=e+1;return(e=>{let t={};return Object.keys(e).forEach((o=>{null!==e[o]&&(t[o]=e[o])})),t})({top:n>o?e-o:null,right:n%o!=0?e+1:null,bottom:n<=(t-1)*o?e+o:null,left:n%o!=1?e-1:null})},l=["top","right","bottom","left"],d=e=>"top"===e||"bottom"===e,h=(e=100,t=100)=>{const o=t/110,n=e/2;return[{cx1:0,cy1:0,cx2:n-20*o,cy2:4*o,ex:n-13*o,ey:0*o},{cx1:n-13*o,cy1:0*o,cx2:n-10*o,cy2:-2*o,ex:n-12*o,ey:-5*o},{cx1:n-12*o,cy1:-5*o,cx2:n-30*o,cy2:-30*o,ex:n,ey:-30*o},{cx1:n,cy1:-30*o,cx2:n- -30*o,cy2:-31*o,ex:n- -12*o,ey:-5*o},{cx1:n- -12*o,cy1:-5*o,cx2:n- -10*o,cy2:-2*o,ex:n- -13*o,ey:0*o},{cx1:n- -13*o,cy1:0*o,cx2:n- -20*o,cy2:4*o,ex:e,ey:0*o}]},p=(e,t=1)=>e.map(((e,o)=>({cx1:e.cx1*t,cy1:-1*e.cy1,cx2:e.cx2*t,cy2:-1*e.cy2,ex:e.ex*t,ey:-1*e.ey}))),u=(e,t)=>{const n=[...Array(t.y*t.x)],i=e.width/t.x,s=e.height/t.y,a=n.map(((e,o)=>({id:o,origin:{x:o%t.x,y:Math.floor(o/t.x)},pos:{x:0,y:0},neighbors:r(o,t.y,t.x),active:!1,connections:[]}))).reduce(((e,t)=>(n,i)=>{const s=e=>n.find((t=>t.id===e)),a=(e,t)=>s(e)?.shapes&&s(e).shapes[(e=>({top:"bottom",right:"left",bottom:"top",left:"right"}[e]))(t)],c={...(({neighbors:e},t,n)=>Object.keys(e).reduce(((i,s)=>({[s]:a(e[s],s)?p(a(e[s],s)):o()>=.5?h(d(s)?t:n,Math.min(t,n)):p(h(d(s)?t:n,Math.min(t,n))),...i})),{}))(i,e,t),...(({neighbors:e})=>l.filter((t=>!Object.keys(e).includes(t))).reduce(((e,t)=>({[t]:"flat",...e})),{}))(i)};return[{...i,shapes:c},...n]})(i,s),[]);return a},y=e=>[...new Set(e)],x=(e,t)=>t.active?-1:1,f=e=>t=>t.reduceRight(((t,o,n,i)=>[...t,e(o,n,i,t)]),[]);function m(e){const t=[...e];let o=t.length;for(;o>0;){let e=Math.floor(Math.random()*o);o--;let n=t[o];t[o]=t[e],t[e]=n}return t}const g=(e,t)=>Math.random()*t-e,w=(e=!1)=>t=>({...t,pieces:e?m(t.pieces).map(((e,o)=>({...e,connections:[],pos:{x:o%t.size.x*t.width/t.size.x*2+g(-t.width/t.size.x,t.width/t.size.x)-t.width/1.5,y:Math.floor(o/t.size.x)*t.height/t.size.y*2+g(-t.height/t.size.y,t.height/t.size.y)-t.height/1.5}}))):t.pieces.map(((e,n)=>({...e,connections:[],pos:{x:(2*o()-.5)*t.width,y:(2*o()-.5)*t.height}})))});let v=1;const z={x:window.innerWidth/2,y:window.innerHeight/2},b=({x:e,y:t,bounding:o={x:1/0,y:1/0}})=>(z.x=z.x+e,z.y=z.y+t,{position:z,scale:v}),M=({focal:e,zoom:t,max:o=1e4,min:n=.05})=>{const i=v===o||v===n;v=((e,t,o)=>Math.max(t,Math.min(o,e)))(v*t,n,o);const s=i?z.x:e.x,a=i?z.y:e.y;return z.x=s-(s-z.x)*t,z.y=a-(a-z.y)*t,{position:z,scale:v}};var E=(e,{dpi:t=window.devicePixelRatio,bounding:o=null,initScale:n=1}={})=>{e.style.touchAction="none",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.overscrollBehaviour="contain";let i={},s=null;v=n;const a=t=>{e.dispatchEvent(new CustomEvent("pan",{detail:t,bubbles:!0,cancelable:!0,composed:!1}))};setTimeout((()=>a({scale:v,position:z})));const c=t=>{t.preventDefault(),i[t.pointerId]={x:t.offsetX,y:t.offsetY,deltaX:0,deltaY:0},e.addEventListener("pointerleave",l,{once:!0})},r=e=>{if(e.preventDefault(),!i[e.pointerId])return;if(2!==Object.keys(i).length)return;i[e.pointerId]={x:e.offsetX,y:e.offsetY,deltaX:e.offsetX-i[e.pointerId].x,deltaY:e.offsetY-i[e.pointerId].y};const o=Object.values(i),n=Math.sqrt(Math.pow(o[1].x-o[0].x,2)+Math.pow(o[1].y-o[0].y,2)),{position:c}=b({x:i[e.pointerId].deltaX*t*.7,y:i[e.pointerId].deltaY*t*.7}),{scale:r}=M({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:s?1+(n-s)/200:1});s=n,a({scale:r,position:c})},l=e=>{e.preventDefault(),delete i[e.pointerId],s=null};return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?(e.addEventListener("pointerdown",c),e.addEventListener("pointermove",r),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l)):e.addEventListener("wheel",(e=>{e.preventDefault(),e.ctrlKey?a(M({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:1-e.deltaY/100})):a(b({x:-e.deltaX,y:-e.deltaY}))})),{zoom:e=>{M({focal:{x:window.innerWidth/2*t,y:window.innerHeight/2*t},zoom:e}),a({scale:v,position:z})}}};const I=({x:e,y:t},o=Math.min(2,window.devicePixelRatio))=>[(e*o-z.x)/v,(t*o-z.y)/v],C=(e,{x:t,y:o,width:n,height:i})=>{const[s,a]=I({x:t,y:o});return s>=e.pos.x&&s<=e.pos.x+n&&a>=e.pos.y&&a<=e.pos.y+i},S=(e,{x:t,y:o})=>{const[n,i]=I({x:t,y:o});return{x:n-e.pos.x,y:i-e.pos.y}},Y=t((e=>{e.pieces=e.pieces.map((e=>({...e,active:!1})))})),T=t((e=>{const t=e.pieces.filter((e=>e.active)),{width:o,height:n,size:i}=e;t.length&&t.length!==e.pieces.length&&t.forEach((t=>{Object.entries(t.neighbors).forEach((([s,a])=>{const r=e.pieces.find(c("id",a));if(((e,t,o,n)=>{const{attraction:i,width:s,height:a,size:c}=o,r=Math.max(o.width,o.height)*i/100,l=d(n)?"y":"x",h="x"===l?"y":"x",p=!(e=>"top"===e||"left"===e)(n),u="y"===l?a/c.y:s/c.x,y=p?t.pos[l]+u:t.pos[l]-u;return e.pos[l]<=y+r&&e.pos[l]>=y-r&&e.pos[h]<=t.pos[h]+r&&e.pos[h]>=t.pos[h]-r})(r,t,e,s)){const a={x:r.pos.x+("right"===s?-o/i.x:"left"===s?+o/i.x:0),y:r.pos.y+("top"===s?n/i.y:"bottom"===s?-n/i.y:0)};((e,[...t],o)=>{t.forEach((t=>{const n=e.pieces.find(c("id",t));n.pos={x:n.pos.x+o.x,y:n.pos.y+o.y}}))})(e,t.connections,{x:a.x-t.pos.x,y:a.y-t.pos.y}),t.pos=a,((e,t,o)=>{t.connections=y([t.id,o.id,...t.connections,...o.connections]),t.connections.forEach((o=>{const n=e.pieces.find((e=>e.id===o));n.connections=y(t.connections)})),o.connections.forEach((o=>{const n=e.pieces.find((e=>e.id===o));n.connections=y(t.connections)}))})(e,t,r)}}))}))})),X=t((e=>{"active"===e.status&&(e.moves=e.moves+1),e.pieces[0].connections.length!==e.size.y*e.size.x||e.done||(e.done=!0)})),L=e=>JSON.parse(JSON.stringify(e)),O=({x:e,y:o})=>t((t=>{const n=t.pieces.find((e=>e.active));if(n)return void(t.status="active");!t.pieces.find((n=>C(n,{x:e,y:o,width:t.width/t.size.x,height:t.height/t.size.y})))||n?t.status="idle":t.status="ready"}));(()=>{if(!function(){const e=document.createElement("canvas").getContext("2d");e.fillRect(0,0,40,40),e.drawImage(e.canvas,-40,-40,80,80,50,50,20,20);const t=e.getImageData(50,50,30,30),o=new Uint32Array(t.data.buffer),n=(e,n)=>o[n*t.width+e];return[[9,9],[20,9],[9,20],[20,20]].some((([e,t])=>0!==n(e,t)))||[[10,10],[19,10],[10,19],[19,19]].some((([e,t])=>0===n(e,t)))}())return;const e=CanvasRenderingContext2D.prototype,t=e.drawImage;function o(e,t,o,n,i,s,a,c,r){const{width:l,height:d}=function(e){const t=t=>{const o=globalThis[t];return o&&e instanceof o};if(t("HTMLImageElement"))return{width:e.naturalWidth,height:e.naturalHeight};if(t("HTMLVideoElement"))return{width:e.videoWidth,height:e.videoHeight};if(t("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(t("HTMLCanvasElement")||t("ImageBitmap"))return e}(e);n<0&&(t+=n,n=Math.abs(n)),i<0&&(o+=i,i=Math.abs(i)),c<0&&(s+=c,c=Math.abs(c)),r<0&&(a+=r,r=Math.abs(r));const h=Math.max(t,0),p=Math.min(t+n,l),u=Math.max(o,0),y=Math.min(o+i,d),x=c/n,f=r/i;return[e,h,u,p-h,y-u,t<0?s-t*x:s,o<0?a-o*f:a,(p-h)*x,(y-u)*f]}function n(e){return[3,4,7,8].some((t=>!e[t]))}t?e.drawImage=function(e,i,s){const a=9===arguments.length;if(!a)return t.apply(this,[...arguments]);const c=o(...arguments);return n(c)?void 0:t.apply(this,c)}:console.error("This script requires a basic implementation of drawImage")})();const P=e=>{const{height:t,width:o}=getComputedStyle(e.parentElement),n=Math.min(2,window.devicePixelRatio);e.width=parseInt(o,0)*n,e.height=parseInt(t,0)*n},A=t((e=>{const{canvas:t,ctx:o}=e;o.save(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,t.width,t.height),o.restore()})),k=e=>t((t=>{e.pieces.map(j(e,t))})),j=(e,t)=>o=>{const{ctx:n,image:i}=t,s=e.width/e.size.x,a=e.height/e.size.y,c=Math.max(s,a);n.save(),n.beginPath(),n.translate(o.pos.x,o.pos.y+a),l.forEach((e=>{!function(e,t,o){e.translate(0,o.x),"flat"===t?e.lineTo(o.y,0):t.forEach((t=>{e.bezierCurveTo(t.cx1,t.cy1,t.cx2,t.cy2,t.ex,t.ey)}));e.rotate(Math.PI/2)}(n,o.shapes[e],{x:"top"===e||"bottom"===e?-a:-s,y:"top"===e||"bottom"===e?s:a})})),n.closePath(),n.clip(),n.drawImage(i,o.origin.x*s-c,o.origin.y*a-c,s+2*c,a+2*c,o.pos.x/e.width-c,o.pos.y/e.height-c-a,s+2*c,a+2*c),n.restore();const r=!e.done&&(o.active||o.alsoActive),d=4e-4*e.width;n.shadowColor=r?"rgba(100, 100, 100, 1)":"rgba(50, 50, 50, 1)",n.strokeStyle=r?"rgba(225, 225, 225, 1)":"rgba(220, 220, 220, 1)",n.shadowBlur=r?2*d:d,n.lineWidth=r?2*d:d,n.shadowOffsetX=n.shadowOffsetY=-1,n.lineCap="round",n.lineJoin="round",n.stroke()};return e.puzzle=async({element:e,image:o="",pieces:s={x:6,y:4},attraction:c=5,aligned:r=!1,zoom:l,onComplete:d=(()=>{}),onChange:h=(()=>{})})=>{const p="string"==typeof e?document.querySelector(e):e;if(!p)return void console.warn(`Couldn't find element: ${e}`);const{canvas:y,ctx:m}=(e=>{const t=e&&"CANVAS"===e.tagName?e:document.createElement("canvas"),o=t.getContext("2d");return e&&"CANVAS"!==e.tagName&&(e.appendChild(t),t.style.width="100%",t.style.height="100%",P(t)),{canvas:t,ctx:o}})(p),{image:g,width:v,height:z}=await(b=o,new Promise((e=>{var t=new Image;t.onload=()=>e({image:t,width:t.width,height:t.height}),t.src=b})));var b;const M={zoom:1,position:{x:0,y:0},canvas:y,ctx:m,image:g},j={url:o,moves:0,status:"idle",done:!1,startTime:Date.now(),attraction:c,width:v,height:z,size:{x:s.x,y:s.y},pieces:u(g,s)};let D={};D.puzzle=i(w(r))(j),D.ui=k(D.puzzle)(M);const{zoom:H}=E(y,{initScale:l||Math.min(window.innerWidth/D.puzzle.width,window.innerHeight/D.puzzle.height)}),N=()=>{D.ui=i(A,k(D.puzzle),(e=>t((t=>{t.canvas.style.cursor="active"===e.status?"grabbing":"ready"===e.status?"grab":"default"})))(D.puzzle))(D.ui)};y.addEventListener("pan",(e=>{e.preventDefault();const{detail:{scale:t,position:o}}=e;D.ui.zoom=t,D.ui.position=o,D.ui.ctx.setTransform(t,0,0,t,o.x,o.y),N()}));const R=[a(window).resize((()=>{P(D.ui.canvas),m.setTransform(D.ui.zoom,0,0,D.ui.zoom,D.ui.position.x,D.ui.position.y),N()})),a(D.ui.canvas).pointerdown((e=>{D.puzzle=i((({x:e,y:t})=>o=>{return{...o,pieces:i(f(((n,i,s,a)=>{return{...n,active:!(a.find((c="active",e=>e[c]))||!C(n,{x:e,y:t,width:o.width/o.size.x,height:o.height/o.size.y}))&&S(n,{x:e,y:t})};var c})),f(((o,n,i)=>({...o,active:i.find((e=>e.active&&e.connections.includes(o.id)))?S(o,{x:e,y:t}):o.active}))),n((s=x,e=>e.sort(s)))((e=>!o.done&&e.filter((e=>e.active)).length!==o.pieces.length)))(o.pieces)};var s})({x:e.offsetX,y:e.offsetY}),O({x:e.offsetX,y:e.offsetY}))(D.puzzle),N()})),a(D.ui.canvas).pointermove((e=>{D.puzzle=i((({x:e,y:t})=>o=>{const[n,i]=I({x:e,y:t});return{...o,pieces:"idle"===o.status?o.pieces:o.pieces.map((e=>({...e,pos:e.active?{x:n-e.active.x,y:i-e.active.y}:e.pos})))}})({x:e.offsetX,y:e.offsetY}),O({x:e.offsetX,y:e.offsetY}))(D.puzzle),N()})),a(document.body).pointerup((e=>{D.puzzle=i(T,Y,X,O({x:e.offsetX,y:e.offsetY}))(D.puzzle),N(),h({ui:D.ui,puzzle:L(D.puzzle)}),D.puzzle.done&&d(D)}))];return{newGame:()=>{D.puzzle=i(w(r))(j),N()},getState:()=>({ui:D.ui,puzzle:L(D.puzzle)}),setState:e=>{D.puzzle=i(w(r))(e.puzzle),N()},destroy:()=>{"CANVAS"!==e.tagName&&D.ui.canvas.remove(),D=null,R.map((e=>e.remove()))},setZoom:H,getZoom:()=>D.ui.zoom}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
