var jigsawPuzzle=function(e){"use strict";const t=e=>t=>(e(t),t),n=(e=Math.random())=>.5*(Math.cos(6669.1337*Math.sin(1337.1337*(e+69)))+1),o=e=>t=>n=>("function"==typeof t?t(n):t)?e(n):n,i=(...e)=>t=>[...e].reduce(((e,t)=>t(e)),t),s=(e,t,n)=>{const o=n;return t.addEventListener(e,n),{remove:()=>t.removeEventListener(e,o)}},c=e=>({scroll:e=>s("scroll",window,e),resize:e=>s("resize",window,e),click:t=>s("click",e,t),pointerdown:t=>s("pointerdown",e,t),pointermove:t=>s("pointermove",e,t),pointerup:e=>s("pointerup",document.body,e)}),a=(e,t)=>n=>n[e]===t,r=(e,t,n)=>{const o=e+1;return(e=>{let t={};return Object.keys(e).forEach((n=>{null!==e[n]&&(t[n]=e[n])})),t})({top:o>n?e-n:null,right:o%n!=0?e+1:null,bottom:o<=(t-1)*n?e+n:null,left:o%n!=1?e-1:null})},l=["top","right","bottom","left"],p=e=>"top"===e||"bottom"===e,u=(e=100,t=100)=>{const n=t/110,o=e/2;return[{cx1:0,cy1:0,cx2:o-10*n,cy2:5*n,ex:o-13*n,ey:0*n},{cx1:o-13*n,cy1:0*n,cx2:o-10*n,cy2:-2*n,ex:o-12*n,ey:-5*n},{cx1:o-12*n,cy1:-5*n,cx2:o-30*n,cy2:-30*n,ex:o,ey:-30*n},{cx1:o,cy1:-30*n,cx2:o- -30*n,cy2:-31*n,ex:o- -12*n,ey:-5*n},{cx1:o- -12*n,cy1:-5*n,cx2:o- -10*n,cy2:-2*n,ex:o- -13*n,ey:0*n},{cx1:o- -13*n,cy1:0*n,cx2:o- -10*n,cy2:5*n,ex:e,ey:0*n}]},d=(e,t=1)=>e.map(((e,n)=>({cx1:e.cx1*t,cy1:-1*e.cy1,cx2:e.cx2*t,cy2:-1*e.cy2,ex:e.ex*t,ey:-1*e.ey}))),h=(e,t)=>{const o=[...Array(t.y*t.x)],i=e.width/t.x,s=e.height/t.y,c=o.map(((e,n)=>({id:n,origin:{x:n%t.x,y:Math.floor(n/t.x)},pos:{x:0,y:0},neighbors:r(n,t.y,t.x),active:!1,connections:[]}))).reduce(((e,t)=>(o,i)=>{const s=e=>o.find((t=>t.id===e)),c=(e,t)=>s(e)?.shapes&&s(e).shapes[(e=>({top:"bottom",right:"left",bottom:"top",left:"right"}[e]))(t)],a={...(({neighbors:e},t,o)=>Object.keys(e).reduce(((i,s)=>({[s]:c(e[s],s)?d(c(e[s],s)):n()>=.5?u(p(s)?t:o,Math.min(t,o)):d(u(p(s)?t:o,Math.min(t,o))),...i})),{}))(i,e,t),...(({neighbors:e})=>l.filter((t=>!Object.keys(e).includes(t))).reduce(((e,t)=>({[t]:"flat",...e})),{}))(i)};return[{...i,shapes:a},...o]})(i,s),[]);return c},z=e=>[...new Set(e)],y=(e,t)=>t.active?-1:1,x=e=>t=>t.reduceRight(((t,n,o,i)=>[...t,e(n,o,i,t)]),[]);function f(e){const t=[...e];let n=t.length;for(;n>0;){let e=Math.floor(Math.random()*n);n--;let o=t[n];t[n]=t[e],t[e]=o}return t}const m=(e=!1)=>t=>({...t,puzzle:{...t.puzzle,pieces:e?f(t.puzzle.pieces).map(((e,n)=>({...e,connections:[],pos:{x:n%t.puzzle.size.x*t.puzzle.width/t.puzzle.size.x*1.5,y:Math.floor(n/t.puzzle.size.x)*t.puzzle.height/t.puzzle.size.y*1.5}}))):t.puzzle.pieces.map(((e,o)=>({...e,connections:[],pos:{x:(2*n()-.5)*t.puzzle.width,y:(2*n()-.5)*t.puzzle.height}})))}});let g=1;const v={x:window.innerWidth/2,y:window.innerHeight/2},w=({x:e,y:t,bounding:n={x:1/0,y:1/0}})=>(v.x=v.x+e,v.y=v.y+t,{position:v,scale:g}),b=({focal:e,zoom:t,max:n=1e4,min:o=.05})=>{const i=g===n||g===o;g=((e,t,n)=>Math.max(t,Math.min(n,e)))(g*t,o,n);const s=i?v.x:e.x,c=i?v.y:e.y;return v.x=s-(s-v.x)*t,v.y=c-(c-v.y)*t,{position:v,scale:g}};var M=(e,{dpi:t=window.devicePixelRatio,bounding:n=null,initScale:o=1}={})=>{e.style.touchAction="none",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.overscrollBehaviour="contain";let i={},s=null;g=o;const c=t=>{e.dispatchEvent(new CustomEvent("pan",{detail:t,bubbles:!0,cancelable:!0,composed:!1}))};setTimeout((()=>c({scale:g,position:v})));const a=t=>{t.preventDefault(),i[t.pointerId]={x:t.offsetX,y:t.offsetY,deltaX:0,deltaY:0},e.addEventListener("pointerleave",l,{once:!0})},r=e=>{if(e.preventDefault(),!i[e.pointerId])return;if(2!==Object.keys(i).length)return;i[e.pointerId]={x:e.offsetX,y:e.offsetY,deltaX:e.offsetX-i[e.pointerId].x,deltaY:e.offsetY-i[e.pointerId].y};const n=Object.values(i),o=Math.sqrt(Math.pow(n[1].x-n[0].x,2)+Math.pow(n[1].y-n[0].y,2)),{position:a}=w({x:i[e.pointerId].deltaX*t*.7,y:i[e.pointerId].deltaY*t*.7}),{scale:r}=b({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:s?1+(o-s)/200:1});s=o,c({scale:r,position:a})},l=e=>{e.preventDefault(),delete i[e.pointerId],s=null};"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?(e.addEventListener("pointerdown",a),e.addEventListener("pointermove",r),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l)):e.addEventListener("wheel",(e=>{e.preventDefault(),e.ctrlKey?c(b({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:1-e.deltaY/100})):c(w({x:-e.deltaX,y:-e.deltaY}))}))};const E=({x:e,y:t},n=window.devicePixelRatio)=>[(e*n-v.x)/g,(t*n-v.y)/g],I=(e,{x:t,y:n,width:o,height:i})=>{const[s,c]=E({x:t,y:n});return s>=e.pos.x&&s<=e.pos.x+o&&c>=e.pos.y&&c<=e.pos.y+i},C=(e,t)=>{const[n,o]=E({x:t.offsetX,y:t.offsetY});return{x:n-e.pos.x,y:o-e.pos.y}},S=e=>({...e,puzzle:{...e.puzzle,pieces:e.puzzle.pieces.map((e=>({...e,active:!1})))}}),T=e=>{const t=e.puzzle.pieces.filter((e=>e.active)),{width:n,height:o,size:i}=e.puzzle;return t.length&&t.length!==e.puzzle.pieces.length?(t.forEach((t=>{Object.entries(t.neighbors).forEach((([s,c])=>{const r=e.puzzle.pieces.find(a("id",c));if(((e,t,n,o)=>{const{attraction:i,width:s,height:c,size:a}=n.puzzle,r=Math.max(n.puzzle.width,n.puzzle.height)*i/100,l=p(o)?"y":"x",u="x"===l?"y":"x",d=!(e=>"top"===e||"left"===e)(o),h="y"===l?c/a.y:s/a.x,z=d?t.pos[l]+h:t.pos[l]-h;return e.pos[l]<=z+r&&e.pos[l]>=z-r&&e.pos[u]<=t.pos[u]+r&&e.pos[u]>=t.pos[u]-r})(r,t,e,s)){const c={x:r.pos.x+("right"===s?-n/i.x:"left"===s?+n/i.x:0),y:r.pos.y+("top"===s?o/i.y:"bottom"===s?-o/i.y:0)};((e,[...t],n)=>{t.forEach((t=>{const o=e.puzzle.pieces.find(a("id",t));o.pos={x:o.pos.x+n.x,y:o.pos.y+n.y}}))})(e,t.connections,{x:c.x-t.pos.x,y:c.y-t.pos.y}),t.pos=c,((e,t,n)=>{t.connections=z([t.id,n.id,...t.connections,...n.connections]),t.connections.forEach((n=>{const o=e.puzzle.pieces.find((e=>e.id===n));o.connections=z(t.connections)})),n.connections.forEach((n=>{const o=e.puzzle.pieces.find((e=>e.id===n));o.connections=z(t.connections)}))})(e,t,r)}}))})),e):e},Y=e=>JSON.parse(JSON.stringify(e.puzzle)),X=e=>t((t=>{const n=t.puzzle.pieces.find((n=>I(n,{x:e.offsetX,y:e.offsetY,width:t.puzzle.width/t.puzzle.size.x,height:t.puzzle.height/t.puzzle.size.y}))),o=t.puzzle.pieces.find((e=>e.active)),i=t.puzzle.pieces.every((e=>e.active));t.ui.cursor=!o||i?!n||o?"default":"grab":"grabbing"})),L=t((e=>{e.ui.canvas.style.cursor=e.ui.cursor}));(()=>{if(!function(){const e=document.createElement("canvas").getContext("2d");e.fillRect(0,0,40,40),e.drawImage(e.canvas,-40,-40,80,80,50,50,20,20);const t=e.getImageData(50,50,30,30),n=new Uint32Array(t.data.buffer),o=(e,o)=>n[o*t.width+e];return[[9,9],[20,9],[9,20],[20,20]].some((([e,t])=>0!==o(e,t)))||[[10,10],[19,10],[10,19],[19,19]].some((([e,t])=>0===o(e,t)))}())return;const e=CanvasRenderingContext2D.prototype,t=e.drawImage;function n(e,t,n,o,i,s,c,a,r){const{width:l,height:p}=function(e){const t=t=>{const n=globalThis[t];return n&&e instanceof n};if(t("HTMLImageElement"))return{width:e.naturalWidth,height:e.naturalHeight};if(t("HTMLVideoElement"))return{width:e.videoWidth,height:e.videoHeight};if(t("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(t("HTMLCanvasElement")||t("ImageBitmap"))return e}(e);o<0&&(t+=o,o=Math.abs(o)),i<0&&(n+=i,i=Math.abs(i)),a<0&&(s+=a,a=Math.abs(a)),r<0&&(c+=r,r=Math.abs(r));const u=Math.max(t,0),d=Math.min(t+o,l),h=Math.max(n,0),z=Math.min(n+i,p),y=a/o,x=r/i;return[e,u,h,d-u,z-h,t<0?s-t*y:s,n<0?c-n*x:c,(d-u)*y,(z-h)*x]}function o(e){return[3,4,7,8].some((t=>!e[t]))}t?e.drawImage=function(e,i,s){const c=9===arguments.length;if(!c)return t.apply(this,[...arguments]);const a=n(...arguments);return o(a)?void 0:t.apply(this,a)}:console.error("This script requires a basic implementation of drawImage")})();const P=e=>t=>{const{ctx:n,image:o}=e.ui,i=e.puzzle.width/e.puzzle.size.x,s=e.puzzle.height/e.puzzle.size.y,c=Math.max(i,s);n.save(),n.beginPath(),n.translate(t.pos.x,t.pos.y+s),l.forEach((e=>{!function(e,t,n){e.translate(0,n.x),"flat"===t?e.lineTo(n.y,0):t.forEach((t=>{e.bezierCurveTo(t.cx1,t.cy1,t.cx2,t.cy2,t.ex,t.ey)}));e.rotate(Math.PI/2)}(n,t.shapes[e],{x:"top"===e||"bottom"===e?-s:-i,y:"top"===e||"bottom"===e?i:s})})),n.closePath(),n.clip(),n.drawImage(o,t.origin.x*i-c,t.origin.y*s-c,i+2*c,s+2*c,t.pos.x/e.puzzle.width-c,t.pos.y/e.puzzle.height-c-s,i+2*c,s+2*c),n.restore();const a=!e.puzzle.done&&(t.active||t.alsoActive);n.shadowColor=a?"rgba(100, 100, 100, 1)":"rgba(50, 50, 50, 1)",n.strokeStyle=a?"rgba(225, 225, 225, 1)":"rgba(220, 220, 220, 1)",n.shadowBlur=a?2:1,n.lineWidth=a?2:1,n.shadowOffsetX=n.shadowOffsetY=-1,n.lineCap="round",n.lineJoin="round",n.stroke()};const O=e=>{const{height:t,width:n}=getComputedStyle(e.parentElement);e.width=parseInt(n,0)*window.devicePixelRatio,e.height=parseInt(t,0)*window.devicePixelRatio},A=t((e=>{const{canvas:t,ctx:n}=e.ui;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.width,t.height),n.restore()})),k=t((e=>{e.puzzle.pieces.map(P(e))}));return e.puzzle=async({element:e,image:n="",pieces:s={x:6,y:4},attraction:a=5,aligned:r=!1,onComplete:l=(()=>{}),onChange:p=(()=>{})})=>{const u="string"==typeof e?document.querySelector(e):e;if(!u)return void console.warn(`Couldn't find element: ${e}`);const{canvas:d,ctx:z}=(e=>{const t="CANVAS"===e.tagName?e:document.createElement("canvas"),n=t.getContext("2d");return"CANVAS"!==e.tagName&&e.appendChild(t),O(t),{canvas:t,ctx:n}})(u),{image:f,width:g,height:v}=await(w=n,new Promise((e=>{var t=new Image;t.onload=()=>e({image:t,width:t.width,height:t.height}),t.src=w})));var w;const b=()=>({ui:{zoom:1,position:{x:0,y:0},canvas:d,ctx:z,image:f,cursor:"default"},puzzle:{done:!1,startTime:Date.now(),attraction:a,width:g,height:v,size:{x:s.x,y:s.y},pieces:h(f,s)}});let P=i(m(r),k)(b());M(d,{initScale:Math.min(window.innerWidth/P.puzzle.width,window.innerHeight/P.puzzle.height)}),d.addEventListener("pan",(e=>{e.preventDefault();const{detail:{scale:t,position:n}}=e;P.ui.zoom=t,P.ui.position=n,A(P),z.setTransform(t,0,0,t,n.x,n.y),k(P)}));const j="function"==typeof p?t(i(Y,p)):()=>()=>P,D=[c(window).resize((()=>{O(P.ui.canvas),A(P),z.setTransform(P.ui.zoom,0,0,P.ui.zoom,P.ui.position.x,P.ui.position.y),k(P)})),c(P.ui.canvas).pointerdown((e=>P=i((e=>t=>{return{...t,puzzle:{...t.puzzle,pieces:i(x(((n,o,i,s)=>{return{...n,active:!(s.find((c="active",e=>e[c]))||!I(n,{x:e.offsetX,y:e.offsetY,width:t.puzzle.width/t.puzzle.size.x,height:t.puzzle.height/t.puzzle.size.y}))&&C(n,e)};var c})),x(((t,n,o)=>({...t,active:o.find((e=>e.active&&e.connections.includes(t.id)))?C(t,e):t.active}))),o((n=y,e=>e.sort(n)))((e=>!t.puzzle.done&&e.filter((e=>e.active)).length!==t.puzzle.pieces.length)))(t.puzzle.pieces)}};var n})(e),X(e),L,A,k)(P))),c(P.ui.canvas).pointermove((e=>{P=i(X(e),(({offsetX:e,offsetY:t})=>n=>{const[o,i]=E({x:e,y:t});return{...n,puzzle:{...n.puzzle,pieces:n.puzzle.pieces.map((e=>({...e,pos:e.active?{x:o-e.active.x,y:i-e.active.y}:e.pos})))}}})(e),A,k,L)(P)})),c(document.body).pointerup((e=>P=i(T,S,X(e),A,k,L,j,(e=>t=>(t.puzzle.pieces[0].connections.length!==t.puzzle.size.y*t.puzzle.size.x||t.puzzle.done||(t.puzzle.done=!0,e(t)),t))(l),t((()=>{console.log(P)})))(P)))];return{newGame:()=>P=i(m(r),A,k)(b()),getState:()=>Y(P),setState:e=>{P.puzzle=e,P=i(A,k)(P)},destroy:()=>{"CANVAS"!==e.tagName&&P.ui.canvas.remove(),P=null,D.map((e=>e.remove()))}}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
