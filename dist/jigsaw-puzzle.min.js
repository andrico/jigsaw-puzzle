var jigsawPuzzle=function(e){"use strict";const t=e=>t=>(e(t),t),i=(e=Math.random())=>.5*(Math.cos(6669.1337*Math.sin(1337.1337*(e+69)))+1),n=e=>t=>i=>("function"==typeof t?t(i):t)?e(i):i,o=(...e)=>t=>[...e].reduce(((e,t)=>t(e)),t),s=(e,t,i)=>{const n=e+1,o={top:n>i?e-i:void 0,right:n%i!=0?e+1:void 0,bottom:n<=(t-1)*i?e+i:void 0,left:n%i!=1?e-1:void 0};return JSON.parse(JSON.stringify(o))},a=["top","right","bottom","left"],c=e=>"top"===e||"bottom"===e,r=(e=100,t=100)=>{const i=t/110,n=e/2;return[{cx1:0,cy1:0,cx2:n-20*i,cy2:4*i,ex:n-13*i,ey:0*i},{cx1:n-13*i,cy1:0*i,cx2:n-10*i,cy2:-2*i,ex:n-12*i,ey:-5*i},{cx1:n-12*i,cy1:-5*i,cx2:n-30*i,cy2:-30*i,ex:n,ey:-30*i},{cx1:n,cy1:-30*i,cx2:n- -30*i,cy2:-31*i,ex:n- -12*i,ey:-5*i},{cx1:n- -12*i,cy1:-5*i,cx2:n- -10*i,cy2:-2*i,ex:n- -13*i,ey:0*i},{cx1:n- -13*i,cy1:0*i,cx2:n- -20*i,cy2:4*i,ex:e,ey:0*i}]},d=(e,t=1)=>e.map(((e,i)=>({cx1:e.cx1*t,cy1:-1*e.cy1,cx2:e.cx2*t,cy2:-1*e.cy2,ex:e.ex*t,ey:-1*e.ey}))),h=(e,t)=>{const n=[...Array(t.y*t.x)],o=e.width/t.x,h=e.height/t.y,l=n.map(((e,i)=>({id:i,origin:{x:i%t.x,y:Math.floor(i/t.x)},pos:{x:0,y:0},neighbors:s(i,t.y,t.x),active:!1,connections:[]}))).reduce(((e,t)=>(n,o)=>{const s=e=>n.find((t=>t.id===e)),h=(e,t)=>s(e)?.shapes&&s(e).shapes[(e=>({top:"bottom",right:"left",bottom:"top",left:"right"}[e]))(t)],l={...(({neighbors:e},t,n)=>Object.keys(e).reduce(((o,s)=>({[s]:h(e[s],s)?d(h(e[s],s)):i()>=.5?r(c(s)?t:n,Math.min(t,n)):d(r(c(s)?t:n,Math.min(t,n))),...o})),{}))(o,e,t),...(({neighbors:e})=>a.filter((t=>!Object.keys(e).includes(t))).reduce(((e,t)=>({[t]:"flat",...e})),{}))(o)};return[{...o,shapes:l},...n]})(o,h),[]);return l},l=e=>[...new Set(e)],p=(e,t)=>t.active?-1:1,u=e=>t=>t.reduceRight(((t,i,n,o)=>[...t,e(i,n,o,t)]),[]);function y(e){const t=[...e];let i=t.length;for(;i>0;){let e=Math.floor(Math.random()*i);i--;let n=t[i];t[i]=t[e],t[e]=n}return t}const x=(e,t)=>Math.random()*t-e,f=(e=!1)=>t=>({...t,pieces:e?y(t.pieces).map(((e,i)=>({...e,connections:[],pos:{x:i%t.size.x*t.width/t.size.x*2+x(-t.width/t.size.x,t.width/t.size.x)-t.width/1.5,y:Math.floor(i/t.size.x)*t.height/t.size.y*2+x(-t.height/t.size.y,t.height/t.size.y)-t.height/1.5}}))):t.pieces.map(((e,n)=>({...e,connections:[],pos:{x:(2*i()-.5)*t.width,y:(2*i()-.5)*t.height}})))});let m=1;const g={x:window.innerWidth/2,y:window.innerHeight/2},v=({x:e,y:t,bounding:i={x:1/0,y:1/0}})=>(g.x=g.x+e,g.y=g.y+t,{position:g,scale:m}),w=({focal:e,zoom:t,max:i=1e4,min:n=.05})=>{const o=m===i||m===n;m=((e,t,i)=>Math.max(t,Math.min(i,e)))(m*t,n,i);const s=o?g.x:e.x,a=o?g.y:e.y;return g.x=s-(s-g.x)*t,g.y=a-(a-g.y)*t,{position:g,scale:m}};var z=(e,{dpi:t=Math.min(2,window.devicePixelRatio),bounding:i=null,initScale:n=1}={})=>{e.style.touchAction="none",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.overscrollBehaviour="contain";let o={},s=null;m=n;const a=t=>{e.dispatchEvent(new CustomEvent("pan",{detail:t,bubbles:!0,cancelable:!0,composed:!1}))};setTimeout((()=>a({scale:m,position:g})));const c=t=>{t.preventDefault(),o[t.pointerId]={x:t.offsetX,y:t.offsetY,deltaX:0,deltaY:0},e.addEventListener("pointerleave",d,{once:!0})},r=e=>{if(e.preventDefault(),!o[e.pointerId])return;if(2!==Object.keys(o).length)return;o[e.pointerId]={x:e.offsetX,y:e.offsetY,deltaX:e.offsetX-o[e.pointerId].x,deltaY:e.offsetY-o[e.pointerId].y};const i=Object.values(o),n=Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),{position:c}=v({x:o[e.pointerId].deltaX*t*.7,y:o[e.pointerId].deltaY*t*.7}),{scale:r}=w({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:s?1+(n-s)/200:1});s=n,a({scale:r,position:c})},d=e=>{e.preventDefault(),delete o[e.pointerId],s=null};return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?(e.addEventListener("pointerdown",c),e.addEventListener("pointermove",r),e.addEventListener("pointerup",d),e.addEventListener("pointercancel",d)):e.addEventListener("wheel",(e=>{e.preventDefault(),e.ctrlKey?a(w({focal:{x:e.offsetX*t,y:e.offsetY*t},zoom:1-e.deltaY/100})):a(v({x:-e.deltaX,y:-e.deltaY}))})),{zoom:e=>{w({focal:{x:window.innerWidth/2*t,y:window.innerHeight/2*t},zoom:e}),a({scale:m,position:g})},restore:()=>{g.x=window.innerWidth/2*Math.min(2,window.devicePixelRatio),g.y=window.innerHeight/2*Math.min(2,window.devicePixelRatio),a({scale:m,position:g})}}};const b=({x:e,y:t},i=Math.min(2,window.devicePixelRatio))=>[(e*i-g.x)/m,(t*i-g.y)/m],M=(e,{x:t,y:i,width:n,height:o})=>{const[s,a]=b({x:t,y:i});return s>=e.pos.x&&s<=e.pos.x+n&&a>=e.pos.y&&a<=e.pos.y+o},E=(e,{x:t,y:i})=>{const[n,o]=b({x:t,y:i});return{x:n-e.pos.x,y:o-e.pos.y}},I=t((e=>{e.pieces=e.pieces.map((e=>({...e,active:!1})))})),S=(e,t)=>i=>i[e]===t,C=t((e=>{const t=e.pieces.filter((e=>e.active)),{width:i,height:n,size:o}=e;t.length&&t.length!==e.pieces.length&&t.forEach((t=>{Object.entries(t.neighbors).forEach((([s,a])=>{const r=e.pieces.find(S("id",a));if(((e,t,i,n)=>{const{attraction:o,width:s,height:a,size:r}=i,d=Math.max(i.width,i.height)*o/100,h=c(n)?"y":"x",l="x"===h?"y":"x",p=!(e=>"top"===e||"left"===e)(n),u="y"===h?a/r.y:s/r.x,y=p?t.pos[h]+u:t.pos[h]-u;return e.pos[h]<=y+d&&e.pos[h]>=y-d&&e.pos[l]<=t.pos[l]+d&&e.pos[l]>=t.pos[l]-d})(r,t,e,s)){const a={x:r.pos.x+("right"===s?-i/o.x:"left"===s?+i/o.x:0),y:r.pos.y+("top"===s?n/o.y:"bottom"===s?-n/o.y:0)};((e,[...t],i)=>{t.forEach((t=>{const n=e.pieces.find(S("id",t));n.pos={x:n.pos.x+i.x,y:n.pos.y+i.y}}))})(e,t.connections,{x:a.x-t.pos.x,y:a.y-t.pos.y}),t.pos=a,((e,t,i)=>{t.connections=l([t.id,i.id,...t.connections,...i.connections]),t.connections.forEach((i=>{const n=e.pieces.find((e=>e.id===i));n.connections=l(t.connections)})),i.connections.forEach((i=>{const n=e.pieces.find((e=>e.id===i));n.connections=l(t.connections)}))})(e,t,r)}}))}))})),T=t((e=>{"active"===e.status&&(e.moves=e.moves+1),e.pieces[0].connections.length!==e.size.y*e.size.x||e.done||(e.done=!0)})),L=e=>JSON.parse(JSON.stringify(e)),P=({x:e,y:i})=>t((t=>{const n=t.pieces.find((e=>e.active));if(n)return void(t.status="active");!t.pieces.find((n=>M(n,{x:e,y:i,width:t.width/t.size.x,height:t.height/t.size.y})))||n?t.status="idle":t.status="ready"}));(()=>{if(!function(){const e=document.createElement("canvas").getContext("2d");e.fillRect(0,0,40,40),e.drawImage(e.canvas,-40,-40,80,80,50,50,20,20);const t=e.getImageData(50,50,30,30),i=new Uint32Array(t.data.buffer),n=(e,n)=>i[n*t.width+e];return[[9,9],[20,9],[9,20],[20,20]].some((([e,t])=>0!==n(e,t)))||[[10,10],[19,10],[10,19],[19,19]].some((([e,t])=>0===n(e,t)))}())return;const e=CanvasRenderingContext2D.prototype,t=e.drawImage;function i(e,t,i,n,o,s,a,c,r){const{width:d,height:h}=function(e){const t=t=>{const i=globalThis[t];return i&&e instanceof i};if(t("HTMLImageElement"))return{width:e.naturalWidth,height:e.naturalHeight};if(t("HTMLVideoElement"))return{width:e.videoWidth,height:e.videoHeight};if(t("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(t("HTMLCanvasElement")||t("ImageBitmap"))return e}(e);n<0&&(t+=n,n=Math.abs(n)),o<0&&(i+=o,o=Math.abs(o)),c<0&&(s+=c,c=Math.abs(c)),r<0&&(a+=r,r=Math.abs(r));const l=Math.max(t,0),p=Math.min(t+n,d),u=Math.max(i,0),y=Math.min(i+o,h),x=c/n,f=r/o;return[e,l,u,p-l,y-u,t<0?s-t*x:s,i<0?a-i*f:a,(p-l)*x,(y-u)*f]}function n(e){return[3,4,7,8].some((t=>!e[t]))}t?e.drawImage=function(e,o,s){const a=9===arguments.length;if(!a)return t.apply(this,[...arguments]);const c=i(...arguments);return n(c)?void 0:t.apply(this,c)}:console.error("This script requires a basic implementation of drawImage")})();const Y=e=>{const{height:t,width:i}=getComputedStyle(e.parentElement),n=Math.min(2,window.devicePixelRatio);e.width=parseInt(i,0)*n,e.height=parseInt(t,0)*n},X=t((e=>{const{canvas:t,ctx:i}=e;i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),i.restore()})),O=e=>t((t=>{X(t),e.pieces.map(A(e,t))})),A=(e,t)=>i=>{const{ctx:n,image:o}=t,s=e.width/e.size.x,c=e.height/e.size.y,r=Math.max(s,c);n.save(),n.beginPath(),n.translate(i.pos.x,i.pos.y+c),a.forEach((e=>{!function(e,t,i){e.translate(0,i.x),"flat"===t?e.lineTo(i.y,0):t.forEach((t=>{e.bezierCurveTo(t.cx1,t.cy1,t.cx2,t.cy2,t.ex,t.ey)}));e.rotate(Math.PI/2)}(n,i.shapes[e],{x:"top"===e||"bottom"===e?-c:-s,y:"top"===e||"bottom"===e?s:c})})),n.closePath(),n.clip(),n.drawImage(o,i.origin.x*s-r,i.origin.y*c-r,s+2*r,c+2*r,i.pos.x/e.width-r,i.pos.y/e.height-r-c,s+2*r,c+2*r),n.restore();const d=!e.done&&(i.active||i.alsoActive),h=4e-4*e.width;n.shadowColor=d?"rgba(100, 100, 100, 1)":"rgba(50, 50, 50, 1)",n.strokeStyle=d?"rgba(225, 225, 225, 1)":"rgba(220, 220, 220, 1)",n.shadowBlur=d?2*h:h,n.lineWidth=d?2*h:h,n.shadowOffsetX=n.shadowOffsetY=-1,n.lineCap="round",n.lineJoin="round",n.stroke()};return e.puzzle=async({element:e,image:i="",pieces:s={x:6,y:4},attraction:a=5,aligned:c=!1,zoom:r,beforeInit:d=(()=>{}),onInit:l=(()=>{}),onComplete:y=(()=>{}),onChange:x=(()=>{})})=>{const m="string"==typeof e?document.querySelector(e):e;if(!m)return void console.warn(`Couldn't find element: ${e}`);const{canvas:g,ctx:v}=(e=>{const t=e&&"CANVAS"===e.tagName?e:document.createElement("canvas"),i=t.getContext("2d");return e&&"CANVAS"!==e.tagName&&(e.appendChild(t),t.style.width="100%",t.style.height="100%",Y(t)),{canvas:t,ctx:i}})(m);d(g);const{image:w,width:S,height:X}=await(A=i,new Promise((e=>{var t=new Image;t.onload=()=>e({image:t,width:t.width,height:t.height}),t.src=A})));var A;const N={zoom:1,position:{x:0,y:0},canvas:g,ctx:v,image:w,useCache:!1},H={url:i,moves:0,status:"idle",done:!1,startTime:Date.now(),attraction:a,width:S,height:X,size:{x:s.x,y:s.y},pieces:h(w,s)};let R={};R.puzzle=o(f(c))(H),R.ui=O(R.puzzle)(N);const{zoom:D,restore:j}=z(g,{initScale:r||Math.min(window.innerWidth/R.puzzle.width,window.innerHeight/R.puzzle.height)}),W=()=>{R.ui=o(O(R.puzzle),(e=>t((t=>{t.canvas.style.cursor="active"===e.status?"grabbing":"ready"===e.status?"grab":"default"})))(R.puzzle))(R.ui)};g.addEventListener("pan",(e=>{e.preventDefault();const{detail:{scale:t,position:i}}=e;R.ui.zoom=t,R.ui.position=i,R.ui.ctx.setTransform(t,0,0,t,i.x,i.y),W()})),setTimeout((()=>{l(R)}));return R.ui.canvas.addEventListener("pointerdown",(({offsetX:e,offsetY:t})=>{R.puzzle=o((({x:e,y:t})=>i=>{return{...i,pieces:o(u(((n,o,s,a)=>{return{...n,active:!(a.find((c="active",e=>e[c]))||!M(n,{x:e,y:t,width:i.width/i.size.x,height:i.height/i.size.y}))&&E(n,{x:e,y:t})};var c})),u(((i,n,o)=>({...i,active:o.find((e=>e.active&&e.connections.includes(i.id)))?E(i,{x:e,y:t}):i.active}))),n((s=p,e=>e.sort(s)))((e=>!i.done&&e.filter((e=>e.active)).length!==i.pieces.length)))(i.pieces)};var s})({x:e,y:t}),P({x:e,y:t}))(R.puzzle),W()})),R.ui.canvas.addEventListener("pointermove",(({offsetX:e,offsetY:t})=>{R.puzzle=o((({x:e,y:t})=>i=>{const[n,o]=b({x:e,y:t});return{...i,pieces:"idle"===i.status?i.pieces:i.pieces.map((e=>({...e,pos:e.active?{x:n-e.active.x,y:o-e.active.y}:e.pos})))}})({x:e,y:t}),P({x:e,y:t}))(R.puzzle),W()})),R.ui.canvas.addEventListener("pointerup",(({offsetX:e,offsetY:t})=>{R.puzzle=o(C,I,T,P({x:e,y:t}))(R.puzzle),W(),x({ui:R.ui,puzzle:L(R.puzzle)}),R.puzzle.done&&y(R)})),window.addEventListener("resize",(()=>{const{zoom:e,position:t}=R.ui;Y(R.ui.canvas),v.setTransform(e,0,0,e,t.x,t.y),W()})),{newGame:()=>{R.puzzle=o(f(c))(H),W()},getState:()=>({ui:R.ui,puzzle:L(R.puzzle)}),setState:e=>{R.puzzle=o(f(c))(e.puzzle),W()},destroy:()=>{"CANVAS"!==e.tagName&&R.ui.canvas.remove(),R=null},setZoom:D,getZoom:()=>R.ui.zoom,restorePan:j}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
